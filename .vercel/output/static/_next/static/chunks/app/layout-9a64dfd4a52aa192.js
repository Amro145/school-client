(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{187:(e,r,a)=>{"use strict";a.d(r,{$J:()=>d,Ay:()=>i,gt:()=>u});var t=a(9267),n=a(2466),s=a(5125);let d=(0,t.zD)("subject/fetchById",async(e,r)=>{let{rejectWithValue:a,getState:t}=r,{auth:d}=t();if(!d.isAuthenticated)return a("User must be authenticated to fetch subject details");try{let r=await n.A.post("",{query:"\n      query MyQuery($id: Int!) {\n        subject(id: $id) {\n          id\n          name\n          teacher {\n            id\n            userName\n          }\n          class {\n            id\n            name\n          }\n          grades {\n            id\n            student {\n              id\n              userName\n            }\n            score\n          }\n        }\n      }\n    ",variables:{id:parseInt(e)}});if(r.data.errors)return a(r.data.errors[0].message);return r.data.data.subject}catch(e){if(s.A.isAxiosError(e)){var o,u;return a((null==(u=e.response)||null==(o=u.data)?void 0:o.message)||e.message||"Failed to fetch subject details")}return a("An unexpected error occurred")}}),o=(0,t.Z0)({name:"subject",initialState:{currentSubject:null,loading:!1,error:null},reducers:{resetSubject:e=>{e.currentSubject=null,e.error=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.loading=!0,e.error=null,e.currentSubject=null}).addCase(d.fulfilled,(e,r)=>{e.loading=!1,e.currentSubject=r.payload}).addCase(d.rejected,(e,r)=>{e.loading=!1,e.error=r.payload||"An error occurred"})}}),{resetSubject:u}=o.actions,i=o.reducer},814:(e,r,a)=>{"use strict";a.d(r,{StoreProvider:()=>l});var t=a(5155),n=a(1213),s=a(9267),d=a(986),o=a(3915),u=a(187);let i=(0,s.U1)({reducer:{admin:d.Ay,auth:o.Ay,subject:u.Ay}});function l(e){let{children:r}=e;return(0,t.jsx)(n.Kq,{store:i,children:r})}},986:(e,r,a)=>{"use strict";a.d(r,{Ay:()=>c,DN:()=>o,QA:()=>d,id:()=>u,un:()=>l,yx:()=>i});var t=a(9267),n=a(2466),s=a(5125);let d=(0,t.zD)("admin/fetchDashboardData",async(e,r)=>{let{rejectWithValue:a,getState:t}=r,{auth:d}=t();if(!d.isAuthenticated)return a("User must be authenticated to fetch admin data");try{let e=await n.A.post("",{query:"\n      query MyQuery {\n        adminDashboardStats {\n          totalStudents\n          totalTeachers\n          totalClassRooms\n        }\n        subjects {\n          id\n          name\n          grades {\n            id\n            score\n          }\n        }\n      }\n    "});if(e.data.errors)return a(e.data.errors[0].message);return e.data.data}catch(e){if(s.A.isAxiosError(e)){var o,u;return a((null==(u=e.response)||null==(o=u.data)?void 0:o.message)||e.message||"Failed to fetch data")}return a("An unexpected error occurred")}}),o=(0,t.zD)("admin/fetchMyStudents",async(e,r)=>{let{rejectWithValue:a,getState:t}=r,{auth:d}=t();if(!d.isAuthenticated)return a("User must be authenticated to fetch students");try{let e=await n.A.post("",{query:"\n      query MyQuery {\n        myStudents {\n          id\n          userName\n          email\n          role\n          class {\n            id\n            name\n          }\n          grades {\n            id\n            score\n          }\n        }\n      }\n    "});if(e.data.errors)return a(e.data.errors[0].message);return e.data.data.myStudents}catch(e){if(s.A.isAxiosError(e)){var o,u;return a((null==(u=e.response)||null==(o=u.data)?void 0:o.message)||e.message||"Failed to fetch students")}return a("An unexpected error occurred")}}),u=(0,t.zD)("admin/fetchMyTeachers",async(e,r)=>{let{rejectWithValue:a,getState:t}=r,{auth:d}=t();if(!d.isAuthenticated)return a("User must be authenticated to fetch teachers");try{let e=await n.A.post("",{query:"\n      query MyQuery {\n        myTeachers {\n          id\n          userName\n          email\n          role\n          subjectsTaught {\n            id\n            name\n            grades {\n              id\n              score\n            }\n          }\n        }\n      }\n    "});if(e.data.errors)return a(e.data.errors[0].message);return e.data.data.myTeachers}catch(e){if(s.A.isAxiosError(e)){var o,u;return a((null==(u=e.response)||null==(o=u.data)?void 0:o.message)||e.message||"Failed to fetch teachers")}return a("An unexpected error occurred")}}),i=(0,t.zD)("admin/fetchSubjects",async(e,r)=>{let{rejectWithValue:a,getState:t}=r,{auth:d}=t();if(!d.isAuthenticated)return a("User must be authenticated to fetch subjects");try{let e=await n.A.post("",{query:"\n      query MyQuery {\n        subjects {\n          id\n          name\n          teacher {\n            id\n            userName\n          }\n          class {\n            id\n            name\n          }\n          grades {\n            id\n            score\n          }\n        }\n      }\n    "});if(e.data.errors)return a(e.data.errors[0].message);return e.data.data.subjects}catch(e){if(s.A.isAxiosError(e)){var o,u;return a((null==(u=e.response)||null==(o=u.data)?void 0:o.message)||e.message||"Failed to fetch subjects")}return a("An unexpected error occurred")}}),l=(0,t.zD)("admin/fetchStudentById",async(e,r)=>{let{rejectWithValue:a,getState:t}=r,{auth:d}=t();if(!d.isAuthenticated)return a("User must be authenticated to fetch student details");try{let r=await n.A.post("",{query:"\n      query MyQuery($id: Int!) {\n        student(id: $id) {\n          id\n          userName\n          email\n          role\n          class {\n            id\n            name\n          }\n          grades {\n            id\n            score\n            subject {\n              id\n              name\n            }\n          }\n        }\n      }\n    ",variables:{id:e}});if(r.data.errors)return a(r.data.errors[0].message);return r.data.data.student}catch(e){if(s.A.isAxiosError(e)){var o,u;return a((null==(u=e.response)||null==(o=u.data)?void 0:o.message)||e.message||"Failed to fetch student")}return a("An unexpected error occurred")}}),c=(0,t.Z0)({name:"admin",initialState:{stats:null,subjects:[],students:[],teachers:[],currentStudent:null,loading:!1,error:null},reducers:{},extraReducers:e=>{e.addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,(e,r)=>{e.loading=!1,e.stats=r.payload.adminDashboardStats,e.subjects=r.payload.subjects}).addCase(d.rejected,(e,r)=>{e.loading=!1,e.error=r.payload||"An error occurred"}).addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,r)=>{e.loading=!1,e.students=r.payload}).addCase(o.rejected,(e,r)=>{e.loading=!1,e.error=r.payload||"An error occurred"}).addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,(e,r)=>{e.loading=!1,e.teachers=r.payload}).addCase(u.rejected,(e,r)=>{e.loading=!1,e.error=r.payload||"An error occurred"}).addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,r)=>{e.loading=!1,e.subjects=r.payload}).addCase(i.rejected,(e,r)=>{e.loading=!1,e.error=r.payload||"An error occurred"}).addCase(l.pending,e=>{e.loading=!0,e.error=null,e.currentStudent=null}).addCase(l.fulfilled,(e,r)=>{e.loading=!1,e.currentStudent=r.payload}).addCase(l.rejected,(e,r)=>{e.loading=!1,e.error=r.payload||"An error occurred"})}}).reducer},2466:(e,r,a)=>{"use strict";a.d(r,{A:()=>o});var t=a(5125),n=a(2378),s=a(5704);let d=t.A.create({baseURL:s.env.NEXT_PUBLIC_API_URL||"https://schoolapi.amroaltayeb14.workers.dev/graphql",headers:{"Content-Type":"application/json"}});d.interceptors.request.use(e=>{let r=n.A.get("auth_token");return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),d.interceptors.response.use(e=>e,e=>{var r;return(null==(r=e.response)?void 0:r.status)===401&&n.A.remove("auth_token"),Promise.reject(e)});let o=d},3673:()=>{},3915:(e,r,a)=>{"use strict";a.d(r,{Ay:()=>c,Lx:()=>u,ri:()=>l});var t=a(9267),n=a(2466),s=a(2378),d=a(5125);let o={user:null,token:s.A.get("auth_token")||null,loading:!1,error:null,isAuthenticated:!!s.A.get("auth_token")},u=(0,t.zD)("auth/login",async(e,r)=>{let{email:a,password:t}=e,{rejectWithValue:o}=r;try{let e=await n.A.post("",{query:"\n      mutation login($email: String!, $password: String!) {\n        login(email: $email, password: $password) {\n          token\n          user {\n            id\n            email\n            userName\n            role\n          }\n        }\n      }\n    ",variables:{email:a,password:t}});if(e.data.errors)return o(e.data.errors[0].message);let{token:r,user:d}=e.data.data.login;return s.A.set("auth_token",r,{expires:7,secure:!0,sameSite:"strict"}),{token:r,user:d}}catch(e){if(d.A.isAxiosError(e)){var u,i;return o((null==(i=e.response)||null==(u=i.data)?void 0:u.message)||e.message||"Login failed")}return o("Login failed")}}),i=(0,t.Z0)({name:"auth",initialState:o,reducers:{logout:e=>{e.user=null,e.token=null,e.isAuthenticated=!1,s.A.remove("auth_token")}},extraReducers:e=>{e.addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,(e,r)=>{e.loading=!1,e.token=r.payload.token,e.user=r.payload.user,e.isAuthenticated=!0}).addCase(u.rejected,(e,r)=>{e.loading=!1,e.error=r.payload})}}),{logout:l}=i.actions,c=i.reducer},3944:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},4740:(e,r,a)=>{Promise.resolve().then(a.t.bind(a,6168,23)),Promise.resolve().then(a.t.bind(a,3944,23)),Promise.resolve().then(a.t.bind(a,3673,23)),Promise.resolve().then(a.bind(a,814))},6168:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}}},e=>{e.O(0,[652,196,441,255,358],()=>e(e.s=4740)),_N_E=e.O()}]);